<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/coviddatasheet.css">
    <link rel="stylesheet" href="/stylesheets/navbar.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Bree+Serif&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/png" href="/assets/images/witechlogo.png">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.13.0/js/all.js"></script>
    <title>Covid Data</title>
</head>

<body class="mainn">
    <%-include('../partials/navbar')%>
    <a id="myBtn" href="#top" title="Go to top"><i class="fas fa-arrow-alt-circle-up fa-3x" style="color:  rgb(255, 187, 0);;"></i></a>
    <!-- <a href="" class="fs-5" style="color: aliceblue; ">Logout</a> <br> -->
    <!-- <a href="/" class="fs-5" style="color: aliceblue; ">Go Back</a> -->
    <!-- <button id="SaveButton">Save</button> -->
    <div class="container cardd table-responsive">
        <h1 class="text-center">Covid Data</h1>
        <table class="table table-borderless table-warning">
            <thead>
              <tr>
                <th scope="col">No</th>
                <th scope="col">State</th>
                <th scope="col">No of Cases</th>
                <th scope="col">Recovered</th>
                <th scope="col">Deaths</th>
                <th scope="col">Oxygen Avalability</th>
                <th scope="col">Beds Avalability</th>
                <th scope="col">No of Vaccines</th>
                <th scope="col">Vaccines Available</th>
                <th scope="col">Waste Percentage</th>
              </tr>
            </thead>
            <tbody>
              <%covid.forEach((element,index)=>{%>
              <tr style="outline-style:solid;outline-color:black;outline-width:1px;">
                <th scope="row"><%=index+1%></th>
                <td class="state"><%=element.state%></td>
                <td><input class="cases" type="text" value="<%=element.cases%>"></td>
                <td><input class="recovered" type="text" value="<%=element.recovered%>"></td>
                <td><input class="death" type="text" value="<%=element.death%>"></td>
                <td><input class="oxygenAvailability" type="text" value="<%=element.oxygenAvailability%>"></td>
                <td><input class="bedsAvailability" type="text" value="<%=element.bedsAvailability%>"></td>
                <td><input class="noOfVaccine" type="text" value="<%=element.noOfVaccine%>"></td>
                <td><input class="vaccineAvailability" type="text" value="<%=element.vaccineAvailability%>"></td>
                <td><input class="waste" type="text" value="<%=element.waste%>"></td>
              </tr>
              <%})%>
            </tbody>
          </table>
    </div>
    <script src="/javascript/navbar.js"></script>
    <script>
      // const SaveButton = document.getElementById('SaveButton');
      const state = document.getElementsByClassName('state');
      const cases = document.querySelectorAll('.cases');
      const recovered = document.querySelectorAll('.recovered');
      const death = document.querySelectorAll('.death');
      const oxygenAvailability = document.querySelectorAll('.oxygenAvailability');
      const bedsAvailability = document.querySelectorAll('.bedsAvailability');
      const noOfVaccine = document.querySelectorAll('.noOfVaccine');
      const vaccineAvailability = document.querySelectorAll('.vaccineAvailability');
      const waste = document.querySelectorAll('.waste');
      
      cases.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'cases',element.value)
        })
      });

      recovered.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'recovered',element.value)
        })
      });

      death.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'death',element.value)
        })
      });

      bedsAvailability.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'bedsAvailability',element.value)
        })
      });

      oxygenAvailability.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'oxygenAvailability',element.value)
        })
      });

      noOfVaccine.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'noOfVaccine',element.value)
        })
      });

      vaccineAvailability.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'vaccineAvailability',element.value)
        })
      });

      waste.forEach((element,index)=>{
        element.addEventListener('keyup',()=>{
          updateData(state[index].innerHTML,'waste',element.value)
        })
      });

      // SaveButton.addEventListener('click',()=>{
      //   var formData=[];
      //   for(let i=0;i<state.length;i++){
      //     formData.push({
      //       state:state[i],
      //       cases:cases[i],
      //       recovered:recovered[i],
      //       death:death[i],
      //       oxygenAvailability:oxygenAvailability[i],
      //       bedsAvailability:bedsAvailability[i],
      //       noOfVaccine:noOfVaccine[i],
      //       vaccineAvailability:vaccineAvailability[i],
      //       waste:waste[i],
      //     });
      //   }
      //   var xhttp=new XMLHttpRequest();
      //   xhttp.open('POST','',true);
      //   xhttp.setRequestHeader('Content-type','application/json');
      //   xhttp.send(JSON.stringify(formData));
      // })

      function updateData(state,field,value){
        var xhttp=new XMLHttpRequest();
        xhttp.open('POST','/covid/api/updateData',true);
        xhttp.setRequestHeader('Content-type','application/json');
        let formData={
          "state":state,
          "field":field,
          "value":value
        }
        xhttp.send(JSON.stringify(formData)); 
      }

    </script>

</body>

</html>